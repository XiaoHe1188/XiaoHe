<!DOCTYPE html>
<html>
	<head>
		<!--
		 作者：张元涛
		 功能：公告信息页面
		 -->
		<meta charset="utf-8">
		<title>小型家装管理系统</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
		<meta name="format-detection" content="telephone=no">
		<meta name="description" content="Violate Responsive announcement Template">
		<meta name="keywords" content="Super announcement, announcement, Template, Bootstrap">

		<!-- 导入CSS文件开始 -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/animate.min.css" rel="stylesheet">
		<link href="css/font-awesome.min.css" rel="stylesheet">
		<link href="css/form.css" rel="stylesheet">
		<link href="css/calendar.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
		<link href="css/icons.css" rel="stylesheet">
		<link href="css/generics.css" rel="stylesheet">
		<!-- 导入CSS文件结束 -->
		<!-- 导入自定义CSS文件开始 -->
		<link rel="stylesheet" type="text/css" href="css/gmd-style.css" />
		<!-- 导入自定义CSS文件结束 -->
		<!-- 设置站点图标 -->
		<link href="img/favicon.ico" rel="icon" />
	</head>
	<body id="skin-tectile">

		<!-- 页面顶部开始 -->
		<header id="header" class="media">
			<!-- 显示/隐藏菜单 -->
			<a href="" id="menu-toggle"></a>
			<!-- LOGO标题 -->
			<a class="logo pull-left" href="scheme.html">小型家装管理系统 1.0</a>

			<div class="media-body">
				<div class="media" id="top-menu">
					<div id="time" class="pull-right">
						<span id="hours"></span>
						:
						<span id="min"></span>
						:
						<span id="sec"></span>
					</div>
				</div>
			</div>
		</header>
		<!-- 页面顶部结束 -->
		<div class="clearfix"></div>

		<!-- 页面中部开始 -->
		<section id="main" class="p-relative" role="main">
			<!-- 页面左侧开始 -->
			<aside id="sidebar">

			</aside>
			<!-- 页面左侧结束 -->

			<!-- 页面右侧开始 -->
			<section id="content" class="container">
				<!-- 路径导航开始 -->
				<ol class="breadcrumb hidden-xs">
					<li class="active">公告信息</li>
				</ol>
				<!-- 路径导航结束 -->

				<!-- 页面子标题 -->
				<h4 class="page-title">公告信息</h4>

				<!-- 查询条件开始 -->
				<div class="block-area" id="text-input">
					<h3 class="block-title">查询条件</h3>
					<div class="row">
						<div class="col-lg-3">
							<input type="text" class="form-control input-sm" id="selectAnnouncement"
								placeholder="主题/内容" />
						</div>
						<div class="col-lg-3">
							<button type="button" class="btn m-r-5 btn-sm" id="selectBtn">查询</button>
							<button type="button" class="btn m-r-5 btn-sm" data-toggle="modal" href="#updateAnnouncementMessageModal" id="insertBtn">添加</button>
						</div>
					</div>
				</div>
				<!-- 查询条件结束 -->

				<!-- 查询结果开始 -->
				<div class="block-area" id="text-input">
					<h3 class="block-title">公告信息</h3>
					<div id="announcementBody">
						<div>没有查询到满足条件的公告信息！！！</div>
					</div>
				</div>
				<!-- 查询结果结束 -->

				<!-- 分页按钮开始 -->
				<div class="col-lg-12 text-center">
					<ul class="pagination">
						<!-- <li><a href="#" style="color: #FFFFFF;"><i class="fa fa-angle-left" style="color: #FFFFFF;"></i></a></li>
						<li><a href="#" style="color: #FFFFFF;">1</a></li>
						<li><a href="#" style="color: #FFFFFF;">2</a></li>
						<li><a href="#" style="color: #FFFFFF;">3</a></li>
						<li><a href="#" style="color: #FFFFFF;">4</a></li>
						<li><a href="#" style="color: #FFFFFF;">5</a></li>
						<li><a href="#" style="color: #FFFFFF;"><i class="fa fa-angle-right"></i></a></li> -->
					</ul>
				</div>
				<!-- 分页按钮结束 -->
			</section>
			<!-- 页面右侧结束 -->
		</section>
		<!-- 页面中部结束 -->

		<!-- 用于保存当前页码的隐藏表单域 -->
		<input type="hidden" id="pageNumber" value="1" />
		
		<div class="modal fade" id="updateAnnouncementMessageModal" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content" style="width: 700px;">
					<!-- 模态框顶部开始 -->
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="modalTitle">修改公告信息</h4>
					</div>
					<!-- 模态框顶部结束 -->
		
					<!-- 模态框中部开始 -->
					<div class="modal-body">
						<!-- 用于保存修改公告编号的隐藏表单域 -->
						<input type="hidden" id="updateAnnouncementId" />
						<div class="row">
							<div class="col-lg-2 text-right" style="padding-top: 6px;">公告主题：</div>
							<div class="col-lg-8">
								<input type="text" class="form-control input-sm" id="announcementTheme"
									value="" />
								<div class="error1">
								</div>
							</div>
						</div>
		
						<div class="row m-t-5">
							<div class="col-lg-2 text-right" style="padding-top: 6px;">公告内容：</div>
							<div class="col-lg-8">
								<textarea rows="10" class="form-control input-sm" id="announcementContent"></textarea>
								<div class="error2">
								</div>
							</div>
						</div>
					</div>
					<!-- 模态框中部结束 -->
		
					<!-- 模态框底部开始 -->
					<div class="modal-footer">
						<button type="button" class="btn btn-sm" id="updateAnnouncementMessageBtn">保存</button>
						<button type="button" class="btn btn-sm" data-dismiss="modal">关闭</button>
					</div>
					<!-- 模态框底部结束 -->
				</div>
			</div>
		</div>

		<!-- 导入JS文件开始 -->
		<script src="js/jquery.min.js"></script> <!-- jQuery Library -->
		<script src="js/jquery-ui.min.js"></script> <!-- jQuery UI -->
		<script src="js/jquery.easing.1.3.js"></script> <!-- jQuery Easing - Requirred for Lightbox + Pie Charts-->

		<script src="js/bootstrap.min.js"></script>

		<script src="js/scroll.min.js"></script> <!-- Custom Scrollbar -->
		<script src="js/datetimepicker.min.js"></script> <!-- Date & Time Picker -->

		<script src="js/calendar.min.js"></script> <!-- Calendar -->
		<script src="js/feeds.min.js"></script> <!-- News Feeds -->
		<script src="js/functions.js"></script>
		<!-- 导入JS文件开始 -->

		<!-- 导入自定义JS文件开始 -->
		<script src="js/common/email-component.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/common/check-data.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/content/url.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/common/format.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/content/employeeMessages.js" type="text/javascript" charset="utf-8"></script>
		<!-- 导入自定义JS文件结束 -->

		<!-- 自定义JS代码开始 -->
		<script type="text/javascript">
			// 加载左侧菜单页面
			$("#sidebar").load("left-menu.html");

			$(function() {
				// 激活菜单
				$("#otherMenu").addClass("active");
				$("#otherSubMenu1").addClass("active");
				
				window.onload = function(){
					var loginGrade = JSON.parse(sessionStorage.getItem("loginEmployee")).employeeGrade;
					
					if(loginGrade < 1){
						$("#insertBtn").hide();
					}
				}

				showTable(1);

				/* 查询按钮的单机事件(id属性为selectBtn) */
				$("#selectBtn").click(function() {
					//显示满足条件第一页的公告信息
					showTable(1);
				});
				
				// 添加按钮绑定单击事件
				$("#insertBtn").click(function(){
					$("#modalTitle").text("新建公告信息");
					$("#updateAnnouncementMessageBtn").text("新建");
					$("#announcementTheme").val("");
					$("#announcementContent").val("");
					$("#updateAnnouncementId").val("");
				})
				
				$("#updateAnnouncementMessageBtn").click(function(){
					var text = $(this).text();
					
					var url = url_prefix_other + (text == "保存" ? "update" : "insert") +"Announcement";
					
					if(text == "保存"){
						var args = {
							"announcementTheme": $("#announcementTheme").val(),
							"announcementContent": $("#announcementContent").val(),
							"announcementId": $("#updateAnnouncementId").val()
						};
					}else{
						var args = {
							"announcementTheme": $("#announcementTheme").val(),
							"announcementContent": $("#announcementContent").val(),
							"employeeId": JSON.parse(sessionStorage.getItem("loginEmployee")).employeeId
						};
					}
					
					$.post(url, args, function(result){
						if(result.code == 0){
							alert(result.message);
							showTable($("#pageNumber").val());
							$("#updateAnnouncementMessageModal").modal("hide")
						}else{
							alert(result.message);
						}
					})
				})

				/* 显示满足条件的第N页的公告信息 */
				function showTable(pageNumber) {
					// 将页码保存到ID位pageNumber的隐藏表单域中
					$("#pageNumber").val(pageNumber);
					//alert(pageNumber);
					var url = url_prefix_other + "selectAnnouncement";

					var select = $("#selectAnnouncement").val();

					var args = {
						"announcementTheme": select,
						"announcementContent": select,
						"pageNumber": pageNumber
					};

					$.post(url, args, function(result) {
						// 获得tbody
						var tbody = $("#announcementBody");
						// 移除tbody中所有的table
						tbody.find("table").remove();
						tbody.find("div").remove();

						//alert(result.code);
						if (result.code == 0) {
							// 查询成功，将公告的信息显示在页面的表格中
							// 获得分页信息
							var pages = result.resultData.pages;
							// 在分页信息中获得公告信息
							var list = pages.list;

							// 使用循环将公告信息显示在表格中
							for (var i = 0; i < list.length; i++) {
								// 获得数组中的公告信息
								var announcement = list[i];
								// 创建table
								var table = $(
									'<table border="3" class="noticeMessages" style="width: 70%; height: 200px; margin:0 auto; margin-bottom: 20px;"></table>'
								);

								// 拼接table的内容
								var tableContent = $('<tbody><tr style="height: 30px;">' + 
														'<td style="text-indent: 2em;">' +
															'<h4 style="float: left;">' + announcement.announcementTheme + '</h4>' +
															'<span style="float: right; margin: 10px;">创建时间：' + 
															announcement.announcementDate.substring(0, 10) + '</span>' + 
														'</td>' +
													'</tr>' +
													'<tr>' +
														'<td>' +
															'<p style="text-indent: 2em; margin: 5px;">' + 
																announcement.announcementContent +
															'</p>' +
														'</td>' +
													'</tr>' +
													'<tr>' +
														'<td style="text-indent: 2em;height: 30px;">' +
															'创建人：<span class="creator" value="' + announcement.employeeId + '">' +
															 showCreator(announcement.employeeId) + '</span>' +
															'<span ' + gradeDetermination(1) + ' style="float: right;">' +
																'<a class="updateAnnouncementHref" data-toggle="modal" name=\'' + JSON.stringify(announcement) +
																'\' href="#updateAnnouncementMessageModal">编辑</a>/<a class="deleteAnnouncementHref" style="color: red;" href="' + announcement.announcementId +
																  '">删除公告</a>' +
															'</span>' +
														'</td>' +
													'</tr></tbody>');
													
								table.append(tableContent);
								// 将table添加到tbody中
								tbody.append(table);
							}

							/* 为删除公告超链接绑定单击事件 */
							$(".deleteAnnouncementHref").on("click", function() {
								if (confirm("确定要删除当前公告吗？\n此操作不可逆！！！")) {
									// 获得被点击超链接href属性的值
									var announcementId = $(this).attr("href");

									var url = url_prefix_other + "deleteAnnouncement";

									var args = {
										"announcementId": announcementId
									};

									$.get(url, args, function(result) {
										if (result.code == 0) {
											showTable(pageNumber);
										} else {
											alert(result.message);
										}
									});
								}
								return false;
							});

							/* 为修改公告超链接绑定单击事件 */
							$(".updateAnnouncementHref").on("click", function() {
								$("#modalTitle").text("修改公告信息");
								$("#updateAnnouncementMessageBtn").text("保存");
								$("#announcementTheme").val("");
								$("#announcementContent").val("");
								// 获得公告信息并显示在模态框中
								var announcement = JSON.parse($(this).attr("name"));
								$("#announcementTheme").val(announcement.announcementTheme);
								$("#announcementContent").val(announcement.announcementContent);
								$("#updateAnnouncementId").val(announcement.announcementId);
							});

							//------------------------------分页按钮--------------------------------
							// 获得显示分页按钮的容器(ul)
							var pagination = $(".pagination");
							// 在显示分页按钮的容器中查找所有的li，并移除
							pagination.find("li").remove();

							// 是否需要显示分页按钮
							if (pages.pages > 1) {
								/* 上一页 */
								/* 如果当前为第一页，则上一页按钮无效 */
								if (pages.isFirstPage) {
									pagination.append($(
										'<li><a><i class="fa fa-angle-left" style="color: #FFFFFF;"></i></a></li>'
									));
								} else {
									pagination.append($(
										'<li><a href="' + pages.prePage +
										'" class="pageButtonHref"><i class="fa fa-angle-left" style="color: #FFFFFF;"></i></a></li>'
									));
								}
								/* 普通分页按钮 */
								// 获得分页按钮的数组
								var navigatepageNums = pages.navigatepageNums;
								for (var i = 0; i < navigatepageNums.length; i++) {
									// 当前页的分页按钮无效
									if (navigatepageNums[i] == pageNumber) {
										pagination.append($('<li class="active"><a style="color: #FFFFFF;">' +
											navigatepageNums[i] + '</a></li>'));
									} else {
										pagination.append($('<li><a href="' + navigatepageNums[i] +
											'" class="pageButtonHref" style="color: #FFFFFF;">' +
											navigatepageNums[
												i] + '</a></li>'));
									}
								}

								/* 下一页 */
								/* 如果当前为最后一页，则下一页按钮无效 */
								if (pages.isLastPage) {
									pagination.append($(
										'<li><a><i class="fa fa-angle-right" style="color: #FFFFFF;"></i></a></li>'
									));
								} else {
									pagination.append($(
										'<li><a href="' + pages.nextPage +
										'" class="pageButtonHref"><i class="fa fa-angle-right" style="color: #FFFFFF;"></i></a></li>'
									));
								}

								/* 为动态创建的分页按钮绑定单击事件 */
								$(".pageButtonHref").on("click", function() {
									// 获得被点击超链接href属性的值
									var num = $(this).attr("href");
									// 查询满足条件的第N页的公告信息
									showTable(num);
									// 阻止超链接发出请求
									return false;
								});

							}
						} else {
							// 获得显示分页按钮的容器(ul)
							var pagination = $(".pagination");
							// 在显示分页按钮的容器中查找所有的li，并移除
							pagination.find("li").remove();
							// 查询失败，没有查询到公告信息
							var div = $("<div>" + result.message + "</div>");
							tbody.append(div);
						}
					});
				}

			});
		</script>
		<!-- 自定义JS代码结束 -->
	</body>
</html>
